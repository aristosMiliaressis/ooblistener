#!/bin/bash

. /etc/profile

IP=$(curl -s -4 ifconfig.me)

# makes sure that dns is setup correctly
if [[ "$IP" != "$(dig +short $DOMAIN)" ]]
then
    exit
fi

# restart ooblistener to generate https cert
systemctl restart ooblistener

# wait for ooblistener to generate ssl cert
sleep 30

/opt/start_exploit_srv.sh $DOMAIN

# unregister cronjob
sudo crontab -l | grep -v '/opt/setup_https.sh' | sudo crontab -
