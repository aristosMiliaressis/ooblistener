---
- name: Update repositories cache and install "cron" package
  package:
    name: cron
    state: present
  become: true

- name: Copy setup_https script
  copy:
    src: setup_https.sh
    dest: /opt/setup_https.sh
    owner: root
    group: root
    mode: "0544"
  become: true

- name: Copy performance_report script
  copy:
    src: performance_report.sh
    dest: /usr/bin/performance_report.sh
    owner: root
    group: root
    mode: "0544"
  become: true

- name: Create cronjob to generate TLS certificate when dns records have propagated
  cron:
    name: "check dirs"
    minute: "*/15"
    job: "/opt/setup_https.sh"
  become: true

- name: Create cronjob to send performance report
  cron:
    name: "performance report"
    minute: "0"
    hour: "10"
    job: "/usr/bin/performance_report.sh"
  become: true

- name: Create cronjob to reboot the server
  cron:
    name: "reboot server"
    weekday: "1"
    minute: "0"
    hour: "0"
    job: "/usr/sbin/reboot --reboot"
  become: true
